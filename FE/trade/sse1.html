<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SSE OrderBook 테스트</title>
  </head>
  <body>
    <h2>OrderBook SSE 수신 결과</h2>
    <pre id="output">연결 중...</pre>
    <script>
      const coinId = '5ad4a66b-a017-4e16-85af-bed654a001c4';
      const evtSource = new EventSource(
        `http://localhost:8081/api/coins/${coinId}/orders/orderbook`
      );
      evtSource.onopen = () => {
        document.getElementById('output').textContent =
          '✅ 연결 성공. 데이터 수신 대기 중...\n';
      };
      evtSource.addEventListener('init', e => {
        document.getElementById(
          'output'
        ).textContent += `✅ 초기 연결 메시지: ${e.data}\n\n`;
        console.log('✅ 연결됨:', e.data);
      });
      evtSource.addEventListener('orderbook', function (event) {
        const parsedData = JSON.parse(event.data);
        document.getElementById(
          'output'
        ).textContent += `📈 수신: \n${JSON.stringify(
          parsedData,
          null,
          2
        )}\n\n`;
      });
      evtSource.onmessage = function (e) {
        console.log('📦 기본 메시지 수신:', e.data);
      };
      evtSource.onerror = function (err) {
        console.error('❌ SSE 에러 발생:', err);
        document.getElementById('output').textContent += '❌ 연결 에러 발생\n';
      };
    </script>
  </body>
</html>
